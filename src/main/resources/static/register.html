<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>실종자 등록</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">


    <style>
        :root {
            --primary-color: #000000;
            --background-color: #ffffff;
            --border-color: #e5e5e5;
            --text-color: #333333;
            --accent-color: #0070f3;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.5;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 600px;
            margin: 40px auto;
            padding: 0 20px;
        }
        h1 {
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 2rem;
            text-align: center;
        }
        .form-group {
            margin-bottom: 1.5rem;
        }
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        input[type="text"], input[type="number"], input[type="tel"], input[type="email"],
        input[type="date"], textarea, select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 0.25rem;
            font-size: 1rem;
            transition: border-color 0.2s ease-in-out;
        }
        textarea {
            height: 100px;
            resize: vertical;
        }
        .btn {
            background-color: var(--primary-color);
            color: var(--background-color);
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.25rem;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            width: 100%;
            transition: background-color 0.2s ease-in-out;
            margin-bottom: 1rem;
        }
        .btn:hover {
            background-color: #333333;
        }
        .btn-secondary {
            background-color: #6c757d;
        }
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        .checkbox-group {
            display: flex;
            align-items: flex-start;
            margin-bottom: 1.5rem;
        }
        .checkbox-group input {
            margin-right: 0.5rem;
            margin-top: 0.25rem;
        }
        .checkbox-group label {
            font-size: 0.875rem;
            font-weight: 400;
        }
        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }
        .file-input-wrapper input[type=file] {
            font-size: 100px;
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
        }
        .file-input-wrapper .btn-file {
            background-color: var(--accent-color);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            display: inline-block;
        }
        #form-part-2 {
            display: none;
        }
    </style>
</head>
<body>

<header>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="/index.html">장기 실종 아동 찾기</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">홈으로</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="list.html">실종 아동 보기</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="search.html">실종 아동 검색</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="register.html">실종 아동 등록</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>


<div class="container">
    <form id="registerForm" enctype="multipart/form-data">
        <div id="form-part-1">
            <h1>신고접수자 등록</h1>

            <div class="form-group">
                <label for="reporter_name">신고자 이름</label>
                <input type="text" id="reporter_name" name="reporter_name" required>
            </div>

            <div class="form-group">
                <label for="reporter_phone">연락처</label>
                <input type="tel" id="reporter_phone" name="reporter_phone" required>
            </div>

            <div class="form-group">
                <label for="reporter_email">이메일</label>
                <input type="email" id="reporter_email" name="reporter_email" required>
            </div>

            <button type="button" class="btn" onclick="showPart2()">다음</button>
        </div>

        <div id="form-part-2">
            <h1>실종자 등록</h1>

            <div class="form-group">
                <label for="wr_subject">이름</label>
                <input type="text" id="wr_subject" name="wr_subject" required>
            </div>

            <div class="form-group">
                <label for="age">나이</label>
                <input type="number" id="age" name="age" required>
            </div>

            <div class="form-group">
                <label for="gender">성별</label>
                <select id="gender" name="gender" required>
                    <option value="" disabled selected>성별 선택해주세요</option>
                    <option value="male">남</option>
                    <option value="female">여</option>
                </select>
            </div>

            <div class="form-group">
                <label for="location">실종장소</label>
                <input type="text" id="location" name="location" required>
            </div>

            <div class="form-group">
                <label for="wr_3">실종일자</label>
                <input type="date" id="wr_3" name="wr_3" required>
            </div>


            <div class="form-group">
                <label for="wr_file">사진</label>
                <div class="file-input-wrapper">
                    <button class="btn-file" type="button">사진 선택</button>
                    <input type="file" id="wr_file" name="bf_file[]" accept="image/*" required>
                </div>
            </div>

<!--            <div class="checkbox-group">-->
<!--                <input type="checkbox" id="consent" name="consent" required>-->
<!--                <label for="consent">본 정보와 신고내용은 관리자에게 통보됩니다. 신고내용에 대해 경찰서에 자료를 넘길 수 있음에 동의합니다.</label>-->
<!--            </div>-->

            <button type="submit" class="btn">등록하기</button>
            <button type="button" class="btn btn-secondary" onclick="showPart1()">이전으로</button>
        </div>
    </form>
</div>

<script>
    let reportId = null; // 신고자 ID를 저장할 변수

    // 폼 제출 이벤트 리스너
    document.getElementById('registerForm').addEventListener('submit', function(e) {
        e.preventDefault(); // 폼 제출 방지

        const consentCheckbox = document.getElementById('consent');

        if (document.getElementById('form-part-1').style.display !== 'none') {
            // 신고자 등록 단계
            if (!consentCheckbox.checked) {
                alert('본 정보와 신고내용은 관리자에게 통보됩니다. 체크박스에 동의해야 합니다.');
                return;
            }

            var formData = new FormData(this); // 폼 데이터를 수집

            fetch('/api/missing-child/register/report', {
                method: 'PUT',
                body: formData
            })
                .then(response => response.json())
                .then(data => {
                    if (data.result === 'success') {
                        reportId = data.reportId; // 서버로부터 받은 신고자 ID 저장
                        alert('신고자 정보가 제출되었습니다.');
                        // 다음 단계로 넘어가기
                        showPart2();
                    } else {
                        alert('신고자 정보 제출에 실패했습니다. 다시 시도해주세요.');
                    }
                })
                .catch(error => {
                    console.error('오류 발생:', error);
                    alert('오류가 발생했습니다. 나중에 다시 시도해주세요.');
                });

        } else {
            // 실종자 등록 단계
            if (!consentCheckbox.checked) {
                alert('본 정보와 신고내용은 관리자에게 통보됩니다. 체크박스에 동의해야 합니다.');
                return;
            }

            var formData = new FormData(this);
            formData.append('reportId', reportId); // 신고자 ID 추가

            fetch('/api/missing-child/register/child', {
                method: 'PUT',
                body: formData
            })
                .then(response => response.json())
                .then(data => {
                    if (data.result === 'success') {
                        alert('실종자 정보가 제출되었습니다.');
                        // 필요 시, 성공 후 다른 작업 수행
                    } else {
                        alert('실종자 정보 제출에 실패했습니다. 다시 시도해주세요.');
                    }
                })
                .catch(error => {
                    console.error('오류 발생:', error);
                    alert('오류가 발생했습니다. 나중에 다시 시도해주세요.');
                });
        }
    });

    // 파일 입력 필드의 레이블 업데이트
    document.getElementById('wr_file').addEventListener('change', function(e) {
        var fileName = e.target.files[0].name;
        e.target.previousElementSibling.textContent = fileName;
    });

    // 단계 전환 함수
    function showPart2() {
        document.getElementById('form-part-1').style.display = 'none';
        document.getElementById('form-part-2').style.display = 'block';
    }

    function showPart1() {
        document.getElementById('form-part-2').style.display = 'none';
        document.getElementById('form-part-1').style.display = 'block';
    }
</script>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>