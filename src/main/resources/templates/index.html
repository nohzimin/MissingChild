<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¥ê¸°ì‹¤ì¢…ì•„ë™ì°¾ê¸°</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/mainstyle.css">
    <link rel="stylesheet" href="/assets/css/header.css">
</head>
<body>

<!-- Header -->
<header class="top-header">
    <div class="header-container">
        <!-- ë¡œê³ ì™€ ì™¼ìª½ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="nav-group">
            <a href="/" class="logo">
                <img src="/assets/img/logo.png" alt="ì¥ê¸° ì‹¤ì¢… ì•„ë™ ì°¾ê¸°" class="logo-image">
            </a>

            <!-- ì£¼ìš”ê¸°ëŠ¥ ë“œë¡­ë‹¤ìš´ -->
            <div class="nav-dropdown">
                <button class="dropdown-toggle">
                    ì£¼ìš”ê¸°ëŠ¥
                    <i class="fas fa-chevron-down nav-icon"></i>
                </button>
                <div class="dropdown-menu">
                    <a href="/missing-child/list">ì‹¤ì¢… ì•„ë™ ë³´ê¸°</a>
                    <a href="/missing-child/register">ì‹¤ì¢… ì•„ë™ ë“±ë¡</a>
                </div>
            </div>

            <!-- ê²€ìƒ‰ ë²„íŠ¼ -->
            <a href="/missing-child/search" class="nav-link">
                <i class="fas fa-search nav-icon"></i>
                ì‹¤ì¢…ì•„ë™ ê²€ìƒ‰
            </a>

            <!-- ê²Œì‹œíŒ ë²„íŠ¼ -->
            <a href="/board/list" class="nav-link">
                <i class="fas fa-list nav-icon"></i>
                ê²Œì‹œíŒ
            </a>
        </div>

        <!-- ì˜¤ë¥¸ìª½ ë„¤ë¹„ê²Œì´ì…˜ -->
        <ul class="nav-right">

            <li class="nav-item" th:if="${user == null}">
                <a class="nav-link" href="/login">
                    <i class="fas fa-sign-in-alt nav-icon"></i> ë¡œê·¸ì¸
                </a>
            </li>
            <li class="nav-item" th:if="${user == null}">
                <a class="nav-link dark" href="/signup">
                    <i class="fas fa-user-plus nav-icon"></i> íšŒì›ê°€ì…
                </a>
            </li>
            <li class="nav-item" th:if="${user != null}">
                <a class="nav-link">
                    <i class="fas fa-user nav-icon"></i>
                    <span th:text="${user.name + 'ë‹˜'}">ì´ë¦„</span>
                </a>
            </li>
            <li class="nav-item" th:if="${user != null}">
                <a class="nav-link" href="/mypage">
                    <i class="fas fa-home nav-icon"></i> MYPAGE
                </a>
            </li>
            <li class="nav-item" th:if="${user != null}">
                <a class="nav-link dark" href="/logout">
                    <i class="fas fa-sign-out-alt nav-icon"></i> ë¡œê·¸ì•„ì›ƒ
                </a>
            </li>
        </ul>
    </div>
</header>

<!-- Hero Section -->
<section class="hero">
    <div class="hero-content">
        <h1>ì•ˆë©´ ì¸ì‹ìœ¼ë¡œ ì‹¤ì¢… ì•„ë™ì„ ì°¾ìŠµë‹ˆë‹¤</h1>
        <p>ì¸ê³µì§€ëŠ¥ ê¸°ë°˜ì˜ ì–¼êµ´ ì¸ì‹ ê¸°ìˆ ë¡œ ì‹¤ì¢…ëœ ì•„ì´ë“¤ì„ ë¹ ë¥´ê³  ì •í™•í•˜ê²Œ ì°¾ì•„ì¤ë‹ˆë‹¤.</p>
    </div>
</section>

<!-- Features Section -->
<section class="features">
    <div class="container">
        <h2>ì„œë¹„ìŠ¤ íŠ¹ì§•</h2>
        <div class="row mt-5">
            <div class="col-md-4">
                <div class="feature-item">
                    <div class="card">
                        <div class="card-front">
                            <img src="/assets/img/index/facescaner.gif" alt="AI ì–¼êµ´ ì¸ì‹">
                        </div>
                        <div class="card-back">
                            <h2>AI ì–¼êµ´ ì¸ì‹</h2>
                            <p>ì•ˆë©´ ì¸ì‹ ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ì‹¤ì¢… ì•„ë™ì˜ <br> ì–¼êµ´ì„ ì •í™•í•˜ê²Œ ì‹ë³„í•©ë‹ˆë‹¤</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="feature-item">
                    <div class="card">
                        <div class="card-front">
                            <img src="/assets/img/index/realtime.gif" alt="ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸">
                        </div>
                        <div class="card-back">
                            <h2>ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸</h2>
                            <p>ì‹¤ì¢… ì•„ë™ ë°ì´í„°ëŠ” ì¦‰ì‹œ ì—…ë°ì´íŠ¸ë˜ì–´ <br> ìµœì‹  ìƒíƒœë¥¼ ìœ ì§€í•©ë‹ˆë‹¤</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="feature-item">
                    <div class="card">
                        <div class="card-front">
                            <img src="/assets/img/index/korea.gif" alt="ì „êµ­ ë„¤íŠ¸ì›Œí¬">
                        </div>
                        <div class="card-back">
                            <h2>ì „êµ­ ë„¤íŠ¸ì›Œí¬</h2>
                            <p>ê´€ë ¨ ê¸°ê´€ê³¼ í˜‘ë ¥í•˜ì—¬ ì „êµ­ì ì¸ <br> ê²€ìƒ‰ ë„¤íŠ¸ì›Œí¬ë¥¼ ì œê³µí•©ë‹ˆë‹¤</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- ê·¸ë˜í”„ ì„¹ì…˜ -->
<section class="stats-section">
    <div class="container">
        <h2 class="section-title">ì¥ê¸° ì‹¤ì¢… ì•„ë™ í†µê³„</h2>
        <div class="charts-wrapper">
            <div class="chart-container">
                <canvas id="missingChildStatusChart"></canvas>
                <p>20ë…„ ì´ìƒ ì¥ê¸° ì‹¤ì¢… ì•„ë™ í˜„í™©</p>
            </div>
            <div class="chart-container">
                <canvas id="missingChildFoundStatusChart"></canvas>
                <p>19-23ë…„ ì‹¤ì¢… ì•„ë™ ë“± ë¯¸ë°œê²¬ í˜„í™©</p>
            </div>
        </div>
    </div>
</section>

<!-- ì‹¤ì¢…ì•„ë™ë³´ê¸° -->
<section class="find-child-section">
    <div class="find-child-content">
        <h2 class="section-title">ì‹¤ì¢… ì•„ë™ë“¤ì„ ìœ„í•œ ì‘ì€ ê´€ì‹¬ì´ <br> í° ë³€í™”ë¥¼ ë§Œë“­ë‹ˆë‹¤</h2>
        <a href="/missing-child/list" class="btn btn-primary">ì‹¤ì¢… ì•„ë™ ë³´ê¸°</a>
    </div>
</section>

<!-- ìµœê·¼ ë“±ë¡ëœ ì‹¤ì¢…ì•„ë™ -->
<section class="recent-cases">
    <div class="container">
        <h2>ìµœê·¼ ë“±ë¡ëœ ì‹¤ì¢… ì•„ë™</h2>
        <div class="carousel-container">
            <div id="caseCarousel" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-inner" id="searchResults">
                    <!-- ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¹´ë“œë“¤ì´ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#caseCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#caseCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>
    </div>
</section>

<!-- ì•„ë™ ìƒì„¸ ì •ë³´ ëª¨ë‹¬ -->
<div id="childDetailModal" class="modal fade" tabindex="-1" aria-labelledby="childDetailLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="childDetailLabel">ì•„ë™ ìƒì„¸ ì •ë³´</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="childDetailContent">
                <!-- ì•„ë™ ìƒì„¸ ì •ë³´ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<footer>
    <p>&copy; ë…¸ë‚˜ë¦¬ì¡°</p>
    <a href="#" class="scroll-top">ğŸ”</a>
</footer>

<!-- ì‚¬ìš©ì ì´ë©”ì¼ì„ ì„œë²„ì—ì„œ ë°›ì•„ì™€ ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ -->
<th:block th:if="${user != null}">
    <script>
        const userId = /*[[${'#'}]]*/'[[${user.userId}]]';
        sessionStorage.setItem('userId', userId);
        console.log('Stored userId:', userId);
    </script>
</th:block>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="/assets/js/chartAnimations.js"></script>
<script src="/assets/js/header.js"></script>

<script>
    window.onload = async function () {
        recentList();
    }


    const getImgSrc = (photoUrl) => {
        if (!photoUrl) {
            return "/assets/img/child/default-image.jpg";
        } else if (photoUrl.startsWith("http://") || photoUrl.startsWith("https://")) {
            return photoUrl;
        } else {
            return `/assets/img/child/${photoUrl}`;
        }
    };

    async function recentList() {
        let url = "/api/missing-child/recentList";
        let response = await fetch(url);
        let data = await response.json();
        if (data.result == "success") {
            let missingChildDtoList = data.missingChildDtoList;
            let searchResults = document.querySelector('#searchResults');
            searchResults.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”

            // 4ê°œì”© ê·¸ë£¹í™”
            for (let i = 0; i < missingChildDtoList.length; i += 4) {
                let groupCards = missingChildDtoList.slice(i, i + 4);
                let carouselItem = document.createElement('div');
                carouselItem.className = 'carousel-item' + (i === 0 ? ' active' : '');

                let cardsWrapper = document.createElement('div');
                cardsWrapper.className = 'cards-wrapper';

                groupCards.forEach(child => {
                    // imgSrc ê²°ì •
                    const imgSrc = getImgSrc(child.photoUrl);
                    let card = document.createElement('div');
                    card.className = 'case-card';
                    card.innerHTML = `
                    <img src="${imgSrc}" alt="${child.childName}">
                    <div class="case-info">
                        <h3>${child.childName}</h3>
                        <p>í˜„ì¬ë‚˜ì´: <span>${child.childAge}</span>ì„¸</p>
                        <p>ì‹¤ì¢…ì¼ì: <br> <span>${child.missingSince}</span></p>
                    </div>
                `;

                    // í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
                    card.addEventListener('click', () => showChildDetail(child.childId));

                    cardsWrapper.appendChild(card);
                });

                carouselItem.appendChild(cardsWrapper);
                searchResults.appendChild(carouselItem);
            }
        } else {
            alert("ìƒì„¸ì¡°íšŒ ê³¼ì •ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
    }

    // ì•„ë™ ìƒì„¸ ì •ë³´ ëª¨ë‹¬ í‘œì‹œ í•¨ìˆ˜
    async function showChildDetail(childId) {
        try {
            const url = `/api/missing-child/list/${childId}`;
            const response = await fetch(url);

            if (!response.ok) {
                throw new Error("ì•„ë™ ìƒì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            }

            const child = await response.json();

            const genderText = child.childGender === "M" ? "ë‚¨ì" : "ì—¬ì";
            // imgSrc ê²°ì •
            const imgSrc = getImgSrc(child.photoUrl);

            const detailHtml = `
            <img src="${imgSrc}" class="img-fluid mb-3" alt="${child.childName}">
            <h5>ì´ë¦„: ${child.childName}</h5>
            <p>ë‚˜ì´: ${child.childAge}ì„¸</p>
            <p>ìƒì¼: ${child.dateOfBirth}</p>
            <p>ì„±ë³„: ${genderText}</p>
            <p>ì‹¤ì¢… ì¥ì†Œ: ${child.lastKnownLocation}</p>
            <p>ì‹¤ì¢… ì¼ì: ${child.missingSince}</p>
        `;
            document.getElementById("childDetailContent").innerHTML = detailHtml;

            const modal = new bootstrap.Modal(document.getElementById("childDetailModal"));
            modal.show();
        } catch (error) {
            console.error("Error:", error);
            alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
        }
    }

    // ìŠ¤í¬ë¡¤ íƒ‘ ë²„íŠ¼
    document.querySelector('.scroll-top').addEventListener('click', function(event) {
        event.preventDefault();
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
    });

    // ìŠ¤í¬ë¡¤ íƒ‘ ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€ ì²˜ë¦¬
    window.addEventListener('scroll', function() {
        const scrollTop = document.querySelector('.scroll-top');
        if (window.scrollY > 500) {
            scrollTop.classList.add('visible');
        } else {
            scrollTop.classList.remove('visible');
        }
    });

    // ì°¨íŠ¸ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
    document.addEventListener('DOMContentLoaded', function() {
        const options = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        boxWidth: 12,
                        padding: 15,
                        font: {
                            size: 12
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        font: {
                            size: 11
                        }
                    }
                },
                x: {
                    ticks: {
                        font: {
                            size: 11
                        }
                    }
                }
            }
        };

        const observer = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('animate');
                    observer.unobserve(entry.target);
                }
            });
        }, options);

        document.querySelectorAll('.chart-container').forEach(chart => {
            observer.observe(chart);
        });
    });

    // í”¼ì²˜ ì¹´ë“œ ì• ë‹ˆë©”ì´ì…˜
    document.querySelectorAll('.feature-item').forEach(item => {
        item.addEventListener('mouseenter', function() {
            this.querySelector('.card').style.transform = 'rotateY(180deg)';
        });

        item.addEventListener('mouseleave', function() {
            this.querySelector('.card').style.transform = 'rotateY(0deg)';
        });
    });
</script>
</body>
</html>