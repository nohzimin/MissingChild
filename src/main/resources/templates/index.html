<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>장기실종아동찾기</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/mainstyle.css">
    <link rel="stylesheet" href="/assets/css/header.css">
</head>
<body>

<!-- Header -->
<header class="top-header">
    <div class="header-container">
        <!-- 로고와 왼쪽 네비게이션 -->
        <div class="nav-group">
            <a href="/" class="logo">
                <img src="/assets/img/logo.png" alt="장기 실종 아동 찾기" class="logo-image">
            </a>

            <!-- 주요기능 드롭다운 -->
            <div class="nav-dropdown">
                <button class="dropdown-toggle">
                    주요기능
                    <i class="fas fa-chevron-down nav-icon"></i>
                </button>
                <div class="dropdown-menu">
                    <a href="/missing-child/list">실종 아동 보기</a>
                    <a href="/missing-child/register">실종 아동 등록</a>
                </div>
            </div>

            <!-- 검색 버튼 -->
            <a href="/missing-child/search" class="nav-link">
                <i class="fas fa-search nav-icon"></i>
                실종아동 검색
            </a>

            <!-- 게시판 버튼 -->
            <a href="/board/list" class="nav-link">
                <i class="fas fa-list nav-icon"></i>
                게시판
            </a>
        </div>

        <!-- 오른쪽 네비게이션 -->
        <ul class="nav-right">

            <li class="nav-item" th:if="${user == null}">
                <a class="nav-link" href="/login">
                    <i class="fas fa-sign-in-alt nav-icon"></i> 로그인
                </a>
            </li>
            <li class="nav-item" th:if="${user == null}">
                <a class="nav-link dark" href="/signup">
                    <i class="fas fa-user-plus nav-icon"></i> 회원가입
                </a>
            </li>
            <li class="nav-item" th:if="${user != null}">
                <a class="nav-link">
                    <i class="fas fa-user nav-icon"></i>
                    <span th:text="${user.name + '님'}">이름</span>
                </a>
            </li>
            <li class="nav-item" th:if="${user != null}">
                <a class="nav-link" href="/mypage">
                    <i class="fas fa-home nav-icon"></i> MYPAGE
                </a>
            </li>
            <li class="nav-item" th:if="${user != null}">
                <a class="nav-link dark" href="/logout">
                    <i class="fas fa-sign-out-alt nav-icon"></i> 로그아웃
                </a>
            </li>
        </ul>
    </div>
</header>

<!-- Hero Section -->
<section class="hero">
    <div class="hero-content">
        <h1>안면 인식으로 실종 아동을 찾습니다</h1>
        <p>인공지능 기반의 얼굴 인식 기술로 실종된 아이들을 빠르고 정확하게 찾아줍니다.</p>
    </div>
</section>

<!-- Features Section -->
<section class="features">
    <div class="container">
        <h2>서비스 특징</h2>
        <div class="row mt-5">
            <div class="col-md-4">
                <div class="feature-item">
                    <div class="card">
                        <div class="card-front">
                            <img src="/assets/img/index/facescaner.gif" alt="AI 얼굴 인식">
                        </div>
                        <div class="card-back">
                            <h2>AI 얼굴 인식</h2>
                            <p>안면 인식 알고리즘으로 실종 아동의 <br> 얼굴을 정확하게 식별합니다</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="feature-item">
                    <div class="card">
                        <div class="card-front">
                            <img src="/assets/img/index/realtime.gif" alt="실시간 업데이트">
                        </div>
                        <div class="card-back">
                            <h2>실시간 업데이트</h2>
                            <p>실종 아동 데이터는 즉시 업데이트되어 <br> 최신 상태를 유지합니다</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="feature-item">
                    <div class="card">
                        <div class="card-front">
                            <img src="/assets/img/index/korea.gif" alt="전국 네트워크">
                        </div>
                        <div class="card-back">
                            <h2>전국 네트워크</h2>
                            <p>관련 기관과 협력하여 전국적인 <br> 검색 네트워크를 제공합니다</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- 그래프 섹션 -->
<section class="stats-section">
    <div class="container">
        <h2 class="section-title">장기 실종 아동 통계</h2>
        <div class="charts-wrapper">
            <div class="chart-container">
                <canvas id="missingChildStatusChart"></canvas>
                <p>20년 이상 장기 실종 아동 현황</p>
            </div>
            <div class="chart-container">
                <canvas id="missingChildFoundStatusChart"></canvas>
                <p>19-23년 실종 아동 등 미발견 현황</p>
            </div>
        </div>
    </div>
</section>

<!-- 실종아동보기 -->
<section class="find-child-section">
    <div class="find-child-content">
        <h2 class="section-title">실종 아동들을 위한 작은 관심이 큰 변화를 만듭니다</h2>
        <a href="/missing-child/list" class="btn btn-primary">실종 아동 보기</a>
    </div>
</section>

<!-- 최근 등록된 실종아동 -->
<section class="recent-cases">
    <div class="container">
        <h2>최근 등록된 실종 아동</h2>
        <div id="caseCarousel" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <div id="searchResults" class="cases-grid d-flex justify-content-center">
                        <!-- 동적으로 추가될 내용 -->
                    </div>
                </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#caseCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#caseCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>
    </div>
</section>

<!-- Footer -->
<footer>
    <p>&copy; 노나리조</p>
    <a href="#" class="scroll-top">맨 위로</a>
</footer>

<!-- 사용자 이메일을 서버에서 받아와 세션 스토리지에 저장 -->
<th:block th:if="${user != null}">
    <script>
        const userId = /*[[${'#'}]]*/'[[${user.userId}]]';
        sessionStorage.setItem('userId', userId);
        console.log('Stored userId:', userId);
    </script>
</th:block>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="/assets/js/chartAnimations.js"></script>

<script>
    window.onload = async function () {
        recentList();
    }

    async function recentList() {
        let url = "/api/missing-child/recentList";
        let response = await fetch(url);
        let data = await response.json();
        if(data.result == "success") {
            console.log(data);

            let missingChildDtoList = data.missingChildDtoList;
            let listHtml = ``;
            missingChildDtoList.forEach(child => {
                listHtml += `<div class="case-card mx-3">
                    <img src="/assets/img/child/${child.photoUrl}" alt="${child.childName}">
                    <div class="case-info">
                        <h3>${child.childName}</h3>
                        <p>현재나이: <span>${child.childAge}</span>세</p>
                        <p>실종일자: <br> <span>${child.missingSince}</span></p>
                    </div>
                </div>`;
            });
            document.querySelector('#searchResults').innerHTML = listHtml;
        } else {
            alert("상세조회 과정에서 오류가 발생했습니다.");
        }
    }

    // 스크롤 탑 버튼
    document.querySelector('.scroll-top').addEventListener('click', function(event) {
        event.preventDefault();
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
    });
</script>

</body>
</html>